#!/usr/bin/env python3
import sys
import re
from PyQt5.QtWidgets import (
    QApplication, QMainWindow, QVBoxLayout, QWidget,
    QTextEdit, QPushButton, QLabel, QHBoxLayout, QScrollArea
)
from PyQt5.QtCore import Qt
from PyQt5.QtGui import QFont


class KeywordVerifier(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("Keyword-Based Verifier")
        self.setGeometry(200, 200, 600, 500)

        # Dark theme
        self.setStyleSheet("""
            QMainWindow { background-color: #1e1e1e; }
            QTextEdit { 
                background-color: #2d2d2d; 
                color: #dcdcdc; 
                border: 1px solid #3a3a3a; 
            }
            QPushButton { 
                background-color: #3a3a3a; 
                color: white; 
                border: none; 
                padding: 8px 15px; 
            }
            QPushButton:hover { background-color: #4a4a4a; }
        """)

        # Central widget
        central_widget = QWidget()
        self.setCentralWidget(central_widget)
        layout = QVBoxLayout(central_widget)

        # Title
        title = QLabel("Alternative Hallucination Detector (Keyword-Based)")
        title.setStyleSheet("color: #569cd6; font-size: 16px; padding: 10px;")
        layout.addWidget(title)

        # Input area with scroll
        layout.addWidget(QLabel("Paste LLM Response Below:"))
        self.input_area = QTextEdit()
        self.input_area.setFont(QFont("Monospace", 10))
        self.input_area.setMaximumHeight(150)  # Fixed height with internal scrolling
        layout.addWidget(self.input_area)

        # Buttons
        button_layout = QHBoxLayout()
        self.verify_button = QPushButton("Verify Keywords")
        self.verify_button.clicked.connect(self.verify_response)
        button_layout.addWidget(self.verify_button)

        self.clear_button = QPushButton("Clear")
        self.clear_button.clicked.connect(self.clear_all)
        button_layout.addWidget(self.clear_button)

        layout.addLayout(button_layout)

        # Results area with scroll
        layout.addWidget(QLabel("Verification Result:"))
        self.result_area = QTextEdit()
        self.result_area.setReadOnly(True)
        self.result_area.setFont(QFont("Monospace", 10))
        self.result_area.setMaximumHeight(200)  # Fixed height with internal scrolling
        layout.addWidget(self.result_area)

    def verify_response(self):
        text = self.input_area.toPlainText().strip()
        if not text:
            self.result_area.setText("Please enter some text to verify.")
            return

        # Define hallucination indicators
        indicators = [
            r'\b(maybe|i think|possibly|probably|guess|assume|likely|perhaps|could be|might be|seems|appears)\b',
            r'\b(according to my knowledge|as far as i know|to the best of my knowledge)\b',
            r'\b(i\'?m not sure|not certain|not positive|not guaranteed)\b',
            r'\b(usually|generally|typically|often|sometimes|frequently)\b',
            r'\b(i\'?m sorry|apologies|my apologies)\b'
        ]

        # Define trust indicators
        trust_indicators = [
            r'\b(exact|precise|specific|exact value|official|standard|documented|verified|confirmed|certain)\b',
            r'\b(see man page|check documentation|refer to official|according to specification)\b'
        ]

        # Score text
        indicator_matches = []
        trust_matches = []

        for pattern in indicators:
            matches = re.findall(pattern, text, re.IGNORECASE)
            indicator_matches.extend(matches)

        for pattern in trust_indicators:
            matches = re.findall(pattern, text, re.IGNORECASE)
            trust_matches.extend(matches)

        # Calculate scores
        indicator_score = len(indicator_matches)
        trust_score = len(trust_matches)

        # Determine status
        if indicator_score > trust_score * 2:
            status = "<span style='color:#f44747;'>! HIGH RISK OF HALLUCINATION</span>"
        elif indicator_score > trust_score:
            status = "<span style='color:#ffcc00;'>~ MODERATE RISK</span>"
        else:
            status = "<span style='color:#4ec9b0;'>âœ“ APPEARS RELIABLE</span>"

        # Prepare report
        report = f"{status}<hr>"
        report += f"<b>Indicator Words Found:</b> {indicator_score}<br>"
        report += f"<b>Trust Words Found:</b> {trust_score}<br><br>"

        if indicator_matches:
            report += f"<b>Detected Indicators:</b><br>"
            for match in indicator_matches:
                report += f"- {match}<br>"
            report += "<br>"

        if trust_matches:
            report += f"<b>Detected Trust Indicators:</b><br>"
            for match in trust_matches:
                report += f"- {match}<br>"

        self.result_area.setHtml(report)

    def clear_all(self):
        self.input_area.clear()
        self.result_area.clear()


def main():
    app = QApplication(sys.argv)
    window = KeywordVerifier()
    window.show()
    sys.exit(app.exec_())


if __name__ == "__main__":
    main()
